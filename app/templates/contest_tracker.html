<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contest Tracker</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js" crossorigin="anonymous"></script>
  </head>
  <body class="bg-dark text-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-black shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand fw-semibold" href="{{ url_for('main.index') }}">Striver SDE Tracker</a>
        <div class="d-flex align-items-center gap-2 ms-auto">
          <a
            class="btn btn-sm {% if active_page == 'striver' %}btn-warning text-dark{% else %}btn-outline-light{% endif %}"
            href="{{ url_for('main.index') }}"
          >
            Striver Sheet
          </a>
          <a
            class="btn btn-sm {% if active_page == 'binary_search' %}btn-warning text-dark{% else %}btn-outline-light{% endif %}"
            href="{{ url_for('main.binary_search') }}"
          >
            Binary Search Questions
          </a>
          <a
            class="btn btn-sm {% if active_page == 'contest_tracker' %}btn-warning text-dark{% else %}btn-outline-light{% endif %}"
            href="{{ url_for('main.contest_tracker') }}"
          >
            Contest Tracker
          </a>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <section class="row g-3" id="dashboard-section">
        <div class="col-md-6">
          <div class="card bg-secondary-subtle h-100 text-light" data-user-card="user_one" style="--card-bg: url('{{ url_for('static', filename='img/dashboard-bg.jpg') }}');">
            <div class="card-body">
              <h5 class="card-title">{{ user_one_name }}</h5>
              <p class="card-text small text-uppercase text-white">Contest progress</p>
              {% set total = dashboard['user_one']['total'] or 1 %}
              {% set completed = dashboard['user_one']['completed'] %}
              {% set percent = (completed / total * 100) | round(1) %}
              <div class="progress mb-2" style="height: 10px;">
                <div
                  class="progress-bar bg-success"
                  role="progressbar"
                  style="width: 0%"
                  data-progress-bar="user_one"
                  aria-valuenow="{{ percent }}"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
              <p class="lead mb-2">
                <span data-progress-completed="user_one">{{ completed }}</span>
                /
                <span data-progress-total>{{ dashboard['user_one']['total'] }}</span>
              </p>
              <p class="small text-muted mb-0">Tracking {{ dashboard['metadata']['contest_count'] }} contests</p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card bg-secondary-subtle h-100 text-light" data-user-card="user_two" style="--card-bg: url('{{ url_for('static', filename='img/dashboard-bg.jpg') }}');">
            <div class="card-body">
              <h5 class="card-title">{{ user_two_name }}</h5>
              <p class="card-text small text-uppercase text-white">Contest progress</p>
              {% set total = dashboard['user_two']['total'] or 1 %}
              {% set completed = dashboard['user_two']['completed'] %}
              {% set percent = (completed / total * 100) | round(1) %}
              <div class="progress mb-2" style="height: 10px;">
                <div
                  class="progress-bar bg-primary"
                  role="progressbar"
                  style="width: 0%"
                  data-progress-bar="user_two"
                  aria-valuenow="{{ percent }}"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
              <p class="lead mb-2">
                <span data-progress-completed="user_two">{{ completed }}</span>
                /
                <span data-progress-total>{{ dashboard['user_two']['total'] }}</span>
              </p>
              <p class="small text-muted mb-0">Tracking {{ dashboard['metadata']['contest_count'] }} contests</p>
            </div>
          </div>
        </div>
      </section>

      <hr class="border-secondary my-4" />

      <section class="day-section">
        <div class="table-responsive">
          <table class="table table-dark table-striped align-middle mb-0">
            <thead>
              <tr>
                <th scope="col" style="width: 60px;">#</th>
                <th scope="col">Contest</th>
                <th scope="col" style="width: 160px;">Virtual Contest</th>
                <th scope="col" style="width: 150px;">Max Problems</th>
                <th scope="col" style="width: 180px;">Solved ({{ user_one_name }})</th>
                <th scope="col" style="width: 180px;">Solved ({{ user_two_name }})</th>
              </tr>
            </thead>
            <tbody>
              {% for contest in contests %}
              <tr data-contest-id="{{ contest['id'] }}">
                <td>{{ loop.index }}</td>
                <td class="fw-semibold">{{ contest['title'] }}</td>
                <td>
                  {% if contest.get('contest_link') %}
                  <a class="btn btn-sm btn-outline-light" href="{{ contest['contest_link'] }}" target="_blank" rel="noopener">Virtual Link</a>
                  {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  <span class="badge bg-info text-dark">{{ contest['max_problems'] }}</span>
                </td>
                <td>
                  <input
                    type="number"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    min="0"
                    step="1"
                    max="{{ contest['max_problems'] }}"
                    class="form-control form-control-sm text-center contest-solved-input"
                    value="{{ contest['status'].get('user_one', 0)|int }}"
                    data-user-field="user_one"
                    data-max-problems="{{ contest['max_problems'] }}"
                    aria-label="{{ user_one_name }} solved count for {{ contest['title'] }}"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    min="0"
                    step="1"
                    max="{{ contest['max_problems'] }}"
                    class="form-control form-control-sm text-center contest-solved-input"
                    value="{{ contest['status'].get('user_two', 0)|int }}"
                    data-user-field="user_two"
                    data-max-problems="{{ contest['max_problems'] }}"
                    aria-label="{{ user_two_name }} solved count for {{ contest['title'] }}"
                  />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <script>
      window.APP_CATEGORY = "{{ category }}";
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
